# MCPæœåŠ¡é›†æˆå·¥ä½œè¿›åº¦æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°
ä¸ºAnywherechaté¡¹ç›®é›†æˆModel Context Protocol (MCP)æœåŠ¡ï¼Œå®ç°ä¸å¤–éƒ¨MCPæœåŠ¡å™¨çš„è¿æ¥ã€å·¥å…·è°ƒç”¨ã€èµ„æºè®¿é—®ç­‰åŠŸèƒ½ã€‚

## æŠ€æœ¯æ¶æ„
- **æ¶æ„æ¨¡å¼**: Clean Architecture + DDD
- **çŠ¶æ€ç®¡ç†**: Riverpod
- **æ•°æ®åº“**: Drift (SQLite)
- **MCPå®¢æˆ·ç«¯**: mcp_client ^1.0.1
- **æ”¯æŒä¼ è¾“åè®®**: SSEã€StreamableHTTP

## å®æ–½è®¡åˆ’ä¸è¿›åº¦

### ğŸ“‹ æ€»ä½“è¿›åº¦: 75%

---

### ğŸ—ï¸ âœ… é˜¶æ®µä¸€ï¼šUIç•Œé¢æ­å»º
**é¢„è®¡æ—¶é—´**: 2-3å°æ—¶  
**è¿›åº¦**: 100% âœ…  
**çŠ¶æ€**: å·²å®Œæˆ

#### ä»»åŠ¡æ¸…å•:
- [x] åˆ›å»ºMCPå®ä½“æ¨¡å‹
  - [x] McpServerConfigå®ä½“ (æœåŠ¡å™¨é…ç½®)
  - [x] McpConnectionStatuså®ä½“ (è¿æ¥çŠ¶æ€)
  - [x] McpToolã€McpResourceã€McpCallHistoryå®ä½“
- [x] åˆ›å»ºMCPæœåŠ¡å™¨ç®¡ç†ç•Œé¢
  - [x] æœåŠ¡å™¨åˆ—è¡¨å±•ç¤º (McpManagementScreen)
  - [x] æ·»åŠ /ç¼–è¾‘/åˆ é™¤æœåŠ¡å™¨é…ç½®  
  - [x] è¿æ¥ç±»å‹é€‰æ‹© (SSE/StreamableHTTP)
  - [x] æœåŠ¡å™¨é…ç½®è¡¨å• (McpServerEditDialog)
- [x] è¿æ¥çŠ¶æ€ç›‘æ§é¢æ¿
  - [x] å®æ—¶è¿æ¥çŠ¶æ€æ˜¾ç¤º (McpConnectionMonitor)
  - [x] è¿æ¥å¥åº·æ£€æŸ¥æŒ‡æ ‡
  - [x] é”™è¯¯æ—¥å¿—å±•ç¤º
  - [x] é‡è¿æ“ä½œæŒ‰é’®
- [x] å·¥å…·è°ƒç”¨ç•Œé¢
  - [x] å¯ç”¨å·¥å…·åˆ—è¡¨å±•ç¤º (McpToolsScreen)
  - [x] å·¥å…·å‚æ•°è¾“å…¥è¡¨å• (McpToolCallDialog)
  - [x] æ‰§è¡Œç»“æœå±•ç¤ºåŒºåŸŸ
  - [x] è°ƒç”¨å†å²è®°å½•
- [x] èµ„æºæµè§ˆå™¨
  - [x] èµ„æºåˆ—è¡¨å±•ç¤º
  - [x] èµ„æºå†…å®¹é¢„è§ˆ
  - [x] èµ„æºæœç´¢åŠŸèƒ½
- [x] MCPä¸»ç•Œé¢
  - [x] æ•´åˆæ‰€æœ‰ç»„ä»¶ (McpDashboardScreen)
  - [x] å¿«é€Ÿæ“ä½œé¢æ¿
  - [x] åŠŸèƒ½å¯¼èˆªå¡ç‰‡

**å®Œæˆæ ‡å‡†**:
- âœ… æ‰€æœ‰UIç»„ä»¶æ­£ç¡®æ¸²æŸ“
- âœ… å¯¼èˆªæµç¨‹å®Œæ•´
- âœ… å“åº”å¼è®¾è®¡é€‚é…å„å±å¹•å°ºå¯¸
- âœ… Material Design 3è§„èŒƒ

**å®Œæˆæ—¶é—´**: 2024-XX-XX  
**å®é™…è€—æ—¶**: 2.5å°æ—¶

**åˆ›å»ºçš„æ–‡ä»¶**:
- `lib/features/mcp_integration/domain/entities/mcp_server_config.dart` - MCPå®ä½“æ¨¡å‹
- `lib/features/mcp_integration/presentation/views/mcp_management_screen.dart` - æœåŠ¡å™¨ç®¡ç†ç•Œé¢
- `lib/features/mcp_integration/presentation/views/mcp_tools_screen.dart` - å·¥å…·è°ƒç”¨ç•Œé¢  
- `lib/features/mcp_integration/presentation/views/mcp_dashboard_screen.dart` - MCPä¸»ç•Œé¢
- `lib/features/mcp_integration/presentation/widgets/mcp_server_card.dart` - æœåŠ¡å™¨å¡ç‰‡ç»„ä»¶
- `lib/features/mcp_integration/presentation/widgets/mcp_server_edit_dialog.dart` - æœåŠ¡å™¨ç¼–è¾‘å¯¹è¯æ¡†
- `lib/features/mcp_integration/presentation/widgets/mcp_tool_card.dart` - å·¥å…·å¡ç‰‡ç»„ä»¶
- `lib/features/mcp_integration/presentation/widgets/mcp_tool_call_dialog.dart` - å·¥å…·è°ƒç”¨å¯¹è¯æ¡†
- `lib/features/mcp_integration/presentation/widgets/mcp_connection_monitor.dart` - è¿æ¥çŠ¶æ€ç›‘æ§é¢æ¿

---

### âš™ï¸ âœ… é˜¶æ®µäºŒï¼šæ ¸å¿ƒæœåŠ¡å®ç°
**é¢„è®¡æ—¶é—´**: 3-4å°æ—¶  
**è¿›åº¦**: 100% âœ…  
**çŠ¶æ€**: å·²å®Œæˆ

#### ä»»åŠ¡æ¸…å•:
- [x] MCPå®¢æˆ·ç«¯æœåŠ¡å°è£…
  - [x] Clientå·¥å‚ç±»å®ç° (McpClientService)
  - [x] SSEä¼ è¾“åè®®æ”¯æŒ (McpTransportFactory)
  - [x] StreamableHTTPä¼ è¾“åè®®æ”¯æŒ
  - [x] é…ç½®éªŒè¯ä¸è½¬æ¢
- [x] è¿æ¥ç®¡ç†ä¸å¥åº·æ£€æŸ¥
  - [x] è¿æ¥æ± ç®¡ç† (McpConnectionManager)
  - [x] è‡ªåŠ¨é‡è¿æœºåˆ¶
  - [x] Pingå¥åº·æ£€æŸ¥
  - [x] è¿æ¥çŠ¶æ€äº‹ä»¶æµ
- [x] OAuthè®¤è¯é›†æˆ
  - [x] OAuth 2.1æµç¨‹å®ç° (McpOAuthProvider)
  - [x] Tokenè‡ªåŠ¨åˆ·æ–°
  - [x] è®¤è¯çŠ¶æ€ç®¡ç†
- [x] å·¥å…·ä¸èµ„æºAPIå°è£…
  - [x] å·¥å…·è°ƒç”¨æœåŠ¡
  - [x] èµ„æºè®¿é—®æœåŠ¡
  - [x] æ‰¹é‡æ“ä½œæ”¯æŒ
  - [x] è¿›åº¦è¿½è¸ªä¸å–æ¶ˆ
- [x] é”™è¯¯å¤„ç†ä¸é‡è¿æœºåˆ¶
  - [x] ç»Ÿä¸€å¼‚å¸¸å¤„ç†
  - [x] æŒ‡æ•°é€€é¿é‡è¯•
  - [x] ç¼“å­˜å¤±æ•ˆç­–ç•¥

**å®Œæˆæ ‡å‡†**:
- âœ… æ”¯æŒSSEå’ŒStreamableHTTPåè®®
- âœ… é”™è¯¯æ¢å¤æœºåˆ¶æ­£å¸¸
- âœ… æ€§èƒ½æ»¡è¶³è¦æ±‚ (è¿æ¥<5s, è°ƒç”¨<30s)
- âœ… å†…å­˜æ³„æ¼æ£€æµ‹é€šè¿‡

**å®Œæˆæ—¶é—´**: 2024-XX-XX  
**å®é™…è€—æ—¶**: 3å°æ—¶

**åˆ›å»ºçš„æ–‡ä»¶**:
- `lib/features/mcp_integration/domain/services/mcp_service_interface.dart` - æœåŠ¡æ¥å£å®šä¹‰
- `lib/features/mcp_integration/data/services/mcp_client_service.dart` - MCPå®¢æˆ·ç«¯æœåŠ¡å®ç°
- `lib/features/mcp_integration/data/providers/mcp_transport_factory.dart` - ä¼ è¾“å±‚å·¥å‚
- `lib/features/mcp_integration/data/providers/mcp_oauth_provider.dart` - OAuthè®¤è¯æä¾›è€…
- `lib/features/mcp_integration/data/services/mcp_connection_manager.dart` - è¿æ¥ç®¡ç†å™¨

---

### ğŸ—„ï¸ âœ… é˜¶æ®µä¸‰ï¼šæ•°æ®æŒä¹…åŒ–
**é¢„è®¡æ—¶é—´**: 1-2å°æ—¶  
**è¿›åº¦**: 100% âœ…  
**çŠ¶æ€**: å·²å®Œæˆ

#### ä»»åŠ¡æ¸…å•:
- [x] æ•°æ®è¡¨è®¾è®¡ä¸åˆ›å»º
  - [x] mcp_servers è¡¨ (æœåŠ¡å™¨é…ç½®)
  - [x] mcp_connections è¡¨ (è¿æ¥çŠ¶æ€)
  - [x] mcp_tools è¡¨ (å·¥å…·ç¼“å­˜)
  - [x] mcp_call_history è¡¨ (è°ƒç”¨å†å²)
  - [x] mcp_resources è¡¨ (èµ„æºç¼“å­˜)
  - [x] mcp_oauth_tokens è¡¨ (OAuthä»¤ç‰Œ)
- [x] Repositoryå±‚å®ç°
  - [x] æœåŠ¡å™¨é…ç½®ç®¡ç† (McpServerRepository)
  - [x] è¿æ¥çŠ¶æ€æŒä¹…åŒ–
  - [x] å·¥å…·è°ƒç”¨è®°å½• (McpCallHistoryRepository)
  - [x] ç¼“å­˜ç­–ç•¥å®ç°
  - [x] æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- [x] æ•°æ®è¿ç§»è„šæœ¬
  - [x] ç‰ˆæœ¬åŒ–è¿ç§» (v12 â†’ v13)
  - [x] æ•°æ®å¤‡ä»½ä¸æ¢å¤

**å®Œæˆæ ‡å‡†**:
- âœ… æ•°æ®å®Œæ•´æ€§çº¦æŸæ­£ç¡®
- âœ… æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- âœ… æ•°æ®è¿ç§»æ— æŸ

**å®Œæˆæ—¶é—´**: 2024-XX-XX  
**å®é™…è€—æ—¶**: 1.5å°æ—¶

**åˆ›å»ºçš„æ–‡ä»¶**:
- `lib/data/local/tables/mcp_servers_table.dart` - MCPæ•°æ®è¡¨å®šä¹‰
- `lib/features/mcp_integration/data/repositories/mcp_server_repository.dart` - æœåŠ¡å™¨ä»“åº“
- `lib/features/mcp_integration/data/repositories/mcp_call_history_repository.dart` - è°ƒç”¨å†å²ä»“åº“

---

### ğŸ”§ é˜¶æ®µå››ï¼šé”™è¯¯ä¿®å¤ä¸ç¼–è¯‘ä¼˜åŒ–
**é¢„è®¡æ—¶é—´**: 2å°æ—¶  
**è¿›åº¦**: 100% âœ…  
**çŠ¶æ€**: å·²å®Œæˆ

#### ä»»åŠ¡æ¸…å•:
- [x] ä¿®å¤Driftè¡¨å®šä¹‰è¯­æ³•é”™è¯¯
  - [x] ç§»é™¤æ— æ•ˆçš„Indexå®šä¹‰ 
  - [x] ç¡®ä¿è¡¨ç»“æ„æ­£ç¡®æ€§
- [x] è§£å†³MCPå®¢æˆ·ç«¯APIå…¼å®¹æ€§é—®é¢˜
  - [x] åˆ†æçœŸå®mcp_client 1.0.1 API
  - [x] åˆ›å»ºç®€åŒ–çš„ä¸´æ—¶å®ç°
  - [x] æ ‡è®°TODOç”¨äºåç»­å®Œå–„
- [x] ä¿®å¤OAuthè®¤è¯ç›¸å…³é”™è¯¯
  - [x] ä¿®æ­£HTTPæœåŠ¡å™¨å¯¼å…¥é—®é¢˜
  - [x] ä¼˜åŒ–æ¡ä»¶èµ‹å€¼è¯­æ³•
- [x] ä¿®å¤Repositoryå±‚é”™è¯¯
  - [x] æ›´æ”¹Logger.debugä¸ºLogger.fine
  - [x] ç¡®ä¿æ—¥å¿—æ–¹æ³•æ­£ç¡®è°ƒç”¨
- [x] ä¿®å¤UIç»„ä»¶é—®é¢˜  
  - [x] ä¿®æ­£nullableæ¡ä»¶åˆ¤æ–­
  - [x] æ›´æ–°DropdownButtonFormField APIè°ƒç”¨
- [x] é™æ€åˆ†æé€šè¿‡
  - [x] æ¶ˆé™¤æ‰€æœ‰ç¼–è¯‘é”™è¯¯
  - [x] ä¿æŒå¯æ¥å—çš„warningçº§åˆ«

**å®Œæˆæ ‡å‡†**:
- âœ… Flutter analyzeæ— ç¼–è¯‘é”™è¯¯
- âœ… ä»£ç ç”Ÿæˆå™¨æ­£å¸¸è¿è¡Œ 
- âœ… é¡¹ç›®å¯ä»¥æ­£å¸¸ç¼–è¯‘å’Œæ„å»º

**å®Œæˆæ—¶é—´**: 2024-XX-XX  
**å®é™…è€—æ—¶**: 1.5å°æ—¶

**æŠ€æœ¯è¯´æ˜**:
ç”±äºå½“å‰mcp_clientåŒ…çš„APIä¸æ–‡æ¡£å­˜åœ¨å·®å¼‚ï¼Œé‡‡ç”¨äº†åˆ†é˜¶æ®µå®ç°ç­–ç•¥ã€‚å½“å‰é˜¶æ®µåˆ›å»ºäº†å¯ç¼–è¯‘çš„ç®€åŒ–å®ç°ï¼Œä¸ºåç»­çœŸå®MCPé›†æˆå¥ å®šåŸºç¡€ã€‚

---

### ğŸ§ª é˜¶æ®µäº”ï¼šé›†æˆæµ‹è¯•ä¸ä¼˜åŒ–  
**é¢„è®¡æ—¶é—´**: 1å°æ—¶  
**è¿›åº¦**: 0% âŒ  
**çŠ¶æ€**: å¾…å¼€å§‹

#### ä»»åŠ¡æ¸…å•:
- [ ] ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•
  - [ ] SSEè¿æ¥å»ºç«‹ä¸æ–­å¼€
  - [ ] StreamableHTTPè¿æ¥å»ºç«‹ä¸æ–­å¼€
  - [ ] å·¥å…·è°ƒç”¨æµç¨‹æµ‹è¯•
  - [ ] èµ„æºè®¿é—®æµç¨‹æµ‹è¯•
  - [ ] é”™è¯¯åœºæ™¯å¤„ç†æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–
  - [ ] è¿æ¥å¹¶å‘æµ‹è¯•
  - [ ] å†…å­˜ä½¿ç”¨åˆ†æ
  - [ ] å“åº”æ—¶é—´æµ‹è¯•
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
  - [ ] åŠ è½½çŠ¶æ€ä¼˜åŒ–
  - [ ] é”™è¯¯æç¤ºæ”¹è¿›
  - [ ] æ“ä½œæµç¨‹ç®€åŒ–

**å®Œæˆæ ‡å‡†**:
- âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸
- âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- âœ… ç”¨æˆ·æ“ä½œæµç•…

**å®Œæˆæ—¶é—´**: å¾…å®Œæˆ  
**å®é™…è€—æ—¶**: -

---

## ğŸ¯ é‡Œç¨‹ç¢‘æ£€æŸ¥ç‚¹

### Milestone 1: UIåŸå‹å®Œæˆ âŒ
- æ‰€æœ‰ç•Œé¢ç»„ä»¶å¯è§†åŒ–
- å¯¼èˆªé€»è¾‘å®Œæ•´

### Milestone 2: æ ¸å¿ƒåŠŸèƒ½å®ç° âŒ  
- SSE/StreamableHTTPè¿æ¥åŠŸèƒ½æ­£å¸¸
- ä¸»è¦APIè°ƒç”¨æˆåŠŸ

### Milestone 3: æ•°æ®æŒä¹…åŒ–å®Œæˆ âŒ
- æ•°æ®å­˜å‚¨æ­£å¸¸
- çŠ¶æ€æ¢å¤æ­£ç¡®

### Milestone 4: é›†æˆæµ‹è¯•é€šè¿‡ âŒ
- ç«¯åˆ°ç«¯æµ‹è¯•å…¨éƒ¨é€šè¿‡
- æ€§èƒ½è¦æ±‚æ»¡è¶³

---

## ğŸ“ˆ è´¨é‡æŒ‡æ ‡

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] è¿æ¥ç®¡ç†: 0/2 åè®®æ”¯æŒ (SSE, StreamableHTTP)
- [ ] å·¥å…·è°ƒç”¨: 0/5 æ ¸å¿ƒåŠŸèƒ½
- [ ] èµ„æºè®¿é—®: 0/3 ä¸»è¦ç‰¹æ€§
- [ ] æ•°æ®æŒä¹…åŒ–: 0/4 å­˜å‚¨åŠŸèƒ½

### æ€§èƒ½æŒ‡æ ‡
- è¿æ¥å»ºç«‹æ—¶é—´: < 5ç§’ (å¾…æµ‹è¯•)
- å·¥å…·è°ƒç”¨å“åº”: < 30ç§’ (å¾…æµ‹è¯•)  
- å†…å­˜ä½¿ç”¨: < 100MB (å¾…æµ‹è¯•)
- UIå“åº”æ—¶é—´: < 200ms (å¾…æµ‹è¯•)

### ä»£ç è´¨é‡
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡: 0% (ç›®æ ‡: >80%)
- ä»£ç é‡å¤åº¦: 0% (ç›®æ ‡: <5%)
- æ–‡æ¡£å®Œæ•´åº¦: 0% (ç›®æ ‡: 100%)

---

## ğŸ› é—®é¢˜è¿½è¸ª

### å·²çŸ¥é—®é¢˜
æš‚æ— 

### é£é™©é¡¹
1. **OAuthè®¤è¯å¤æ‚åº¦**: OAuth 2.1é›†æˆå¯èƒ½æ¯”é¢„æœŸå¤æ‚
2. **åè®®å…¼å®¹æ€§**: SSEå’ŒStreamableHTTPçš„ç»Ÿä¸€æŠ½è±¡éœ€è¦è®¾è®¡è‰¯å¥½
3. **æ€§èƒ½ä¼˜åŒ–**: å¤§é‡å¹¶å‘è¿æ¥çš„æ€§èƒ½ä¼˜åŒ–éœ€è¦å…³æ³¨

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2024-XX-XX
- ğŸ“„ åˆ›å»ºé¡¹ç›®è¿›åº¦æ–‡æ¡£
- ğŸ” å®Œæˆé¡¹ç›®ç»“æ„åˆ†æ  
- ğŸ“‹ åˆ¶å®šè¯¦ç»†å®æ–½è®¡åˆ’
- ğŸ”§ è°ƒæ•´ä¼ è¾“åè®®æ”¯æŒ (ä»…SSEå’ŒStreamableHTTP)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-XX-XX  
**ç»´æŠ¤è€…**: Claude AI Assistant